<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Comercial - Update PR602</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; --card: #ffffff; --text: #1e293b; --green: #22c55e; --orange: #f97316; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* Header */
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        h1 { margin: 0; font-size: 1.5rem; }
        .tag-update { background: #dbeafe; color: #1e40af; padding: 5px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }

        /* KPI Grid */
        .grid-kpi { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .card { background: var(--card); padding: 20px; border-radius: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .card h3 { font-size: 0.85rem; color: #64748b; margin: 0 0 10px; text-transform: uppercase; }
        .card .num { font-size: 1.8rem; font-weight: 700; }
        .card .trend { font-size: 0.85rem; margin-top: 5px; }
        .trend.up { color: var(--green); }
        .trend.down { color: var(--orange); }

        /* Funnel Section (NUEVO) */
        .funnel-container { background: white; padding: 25px; border-radius: 12px; margin-bottom: 30px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .funnel-title { font-weight: 700; margin-bottom: 20px; border-bottom: 1px solid #e2e8f0; padding-bottom: 10px; }
        .funnel-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center; }
        .funnel-step { position: relative; padding: 15px; background: #f1f5f9; border-radius: 8px; }
        
        /* Flechas entre etapas */
        .funnel-step:not(:last-child)::after {
            content: "➜"; position: absolute; right: -15px; top: 50%; transform: translateY(-50%); color: #cbd5e1; font-size: 1.2rem; z-index: 10;
        }
        
        .rate-badge {
            background: #1e293b; color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.8rem; font-weight: bold;
            display: inline-block; margin-top: 5px;
        }
        .highlight-metric { border: 2px solid var(--green); background: #f0fdf4; }
        .highlight-label { color: #15803d; font-weight: 700; font-size: 0.75rem; text-transform: uppercase; margin-bottom: 5px; display: block; }

        /* Tables & Charts */
        .layout-split { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 30px; }
        @media(max-width: 768px) { .layout-split { grid-template-columns: 1fr; } .funnel-grid { grid-template-columns: 1fr; gap: 20px; } .funnel-step::after { content: "⬇"; right: 50%; top: auto; bottom: -20px; transform: translateX(50%); } }
        
        table { width: 100%; border-collapse: collapse; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #f1f5f9; font-size: 0.9rem; }
        th { background: #f8fafc; font-weight: 600; color: #64748b; }
        .badge { padding: 3px 8px; border-radius: 4px; font-size: 0.75rem; font-weight: 600; }
        .bg-green { background: #dcfce7; color: #166534; }
        .bg-orange { background: #ffedd5; color: #9a3412; }

    </style>
</head>
<body>

<div class="container">
    <header>
        <div>
            <h1>Reporte de Performance y Conversión</h1>
            <span style="color: #64748b; font-size: 0.9rem;">Cursos PR601 & PR602 | Datos actualizados</span>
        </div>
        <div class="tag-update">Última act: Hoy (PR602 SQLs ↑)</div>
    </header>

    <div class="grid-kpi">
        <div class="card" style="border-top: 4px solid #3b82f6;">
            <h3>Inversión Total</h3>
            <div class="num">$844.90</div>
            <div class="trend">44% del Presupuesto</div>
        </div>
        <div class="card" style="border-top: 4px solid #f97316;">
            <h3>CPL (Costo por Lead)</h3>
            <div class="num">$0.98</div>
            <div class="trend">858 Leads Totales</div>
        </div>
        <div class="card" style="border-top: 4px solid #8b5cf6;">
            <h3>Costo por SQL</h3>
            <div class="num">$52.80</div>
            <div class="trend up">▼ Mejora (Antes $64)</div>
        </div>
        <div class="card" style="border-top: 4px solid #22c55e;">
            <h3>Ventas Totales</h3>
            <div class="num">4</div>
            <div class="trend">CPA Global: $211.22</div>
        </div>
    </div>

    <div class="funnel-container">
        <div class="funnel-title">Embudo de Conversión (Tasas entre etapas)</div>
        <div class="funnel-grid">
            <div class="funnel-step">
                <div style="font-size:0.8rem; color:#64748b;">TOTAL LEADS</div>
                <div style="font-size:1.4rem; font-weight:bold;">858</div>
                <div style="margin-top:5px; font-size:0.8rem;">Prospectos Crudos</div>
            </div>
            
            <div class="funnel-step">
                <div class="highlight-label">Calidad de Lead</div>
                <div style="font-size:0.8rem; color:#64748b;">LEAD A SQL</div>
                <div class="rate-badge">1.86%</div>
                <div style="margin-top:5px; font-size:0.9rem;"><strong>16 SQLs</strong></div>
            </div>

            <div class="funnel-step highlight-metric">
                <div class="highlight-label">★ Tasa de Cierre (Importante)</div>
                <div style="font-size:0.8rem; color:#64748b;">SQL A VENTA</div>
                <div class="rate-badge" style="background:#166534;">25.00%</div>
                <div style="margin-top:5px; font-size:0.9rem;"><strong>4 Ventas</strong></div>
                <div style="font-size:0.7rem; color:#166534; margin-top:2px;">1 de cada 4 SQL compra</div>
            </div>
        </div>
    </div>

    <div class="layout-split">
        <div style="background:white; padding:20px; border-radius:12px; height:300px;">
            <canvas id="sqlChart"></canvas>
        </div>
        
        <div style="background:#eff6ff; padding:20px; border-radius:12px; border:1px solid #bfdbfe;">
            <h3 style="color:#1e40af; margin-top:0;">Proyecciones Actualizadas</h3>
            <p style="font-size:0.9rem; margin-bottom:15px;">Con el ajuste de 6 SQLs en PR602, la eficiencia de la campaña FORM ha mejorado drásticamente (Costo/SQL bajó a $23).</p>
            
            <div style="margin-bottom:15px; background:white; padding:10px; border-radius:8px;">
                <strong>PR602 (Procesos) - ¡Oportunidad!</strong>
                <div style="display:flex; justify-content:space-between; font-size:0.9rem; margin-top:5px;">
                    <span>SQLs Proyectados:</span>
                    <strong>~31</strong>
                </div>
                <div style="display:flex; justify-content:space-between; font-size:0.9rem;">
                    <span>Ventas Estimadas:</span>
                    <strong>~10</strong>
                </div>
                <div style="font-size:0.75rem; color:#64748b; margin-top:5px;">Basado en reinversión total en FORM</div>
            </div>

            <div style="background:white; padding:10px; border-radius:8px;">
                <strong>PR601 (Risk)</strong>
                <div style="display:flex; justify-content:space-between; font-size:0.9rem; margin-top:5px;">
                    <span>SQLs Proyectados:</span>
                    <strong>~16</strong>
                </div>
                <div style="display:flex; justify-content:space-between; font-size:0.9rem;">
                    <span>Ventas Estimadas:</span>
                    <strong>~3</strong>
                </div>
            </div>
        </div>
    </div>

    <table>
        <thead>
            <tr>
                <th>Curso</th>
                <th>Campaña</th>
                <th>Gasto</th>
                <th>SQLs</th>
                <th>Costo/SQL</th>
                <th>Lead → SQL</th>
                <th>Estado</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>PR601 Risk</td>
                <td>WP Conversión</td>
                <td>$150.57</td>
                <td>3</td>
                <td>$50.19</td>
                <td>1.08%</td>
                <td><span class="badge" style="background:#fee2e2; color:#991b1b">OFF</span></td>
            </tr>
            <tr>
                <td>PR601 Risk</td>
                <td>Formulario</td>
                <td>$387.85</td>
                <td>7</td>
                <td>$55.40</td>
                <td>3.11%</td>
                <td><span class="badge bg-green">ON</span></td>
            </tr>
            <tr style="border-top: 2px solid #e2e8f0;">
                <td>PR602 Procesos</td>
                <td>WP Conversión</td>
                <td>$165.01</td>
                <td>0</td>
                <td>-</td>
                <td>0.00%</td>
                <td><span class="badge" style="background:#fee2e2; color:#991b1b">OFF</span></td>
            </tr>
            <tr style="background: #f0fdf4;">
                <td>PR602 Procesos</td>
                <td>Formulario</td>
                <td>$141.47</td>
                <td><strong>6</strong></td>
                <td><strong>$23.57</strong></td>
                <td><strong>4.51%</strong></td>
                <td><span class="badge bg-green">★ ESTRELLA</span></td>
            </tr>
        </tbody>
    </table>

</div>

<script>
    // --- DATOS ACTUALIZADOS ---
    // PR602 ahora tiene 6 SQLs en Formulario (asumido por ser el canal activo)
    const ctx = document.getElementById('sqlChart').getContext('2d');
    
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['PR601 (Risk)', 'PR602 (Procesos)'],
            datasets: [
                {
                    label: 'SQLs Generados',
                    data: [10, 6], // 3+7=10 para PR601, 0+6=6 para PR602
                    backgroundColor: ['#64748b', '#22c55e'],
                    borderRadius: 5
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                title: { display: true, text: 'Volumen de SQLs (Interesados) por Curso' },
                tooltip: {
                    callbacks: {
                        afterLabel: function(context) {
                            if(context.dataIndex === 1) return "¡Eficiencia alta en FORM!";
                        }
                    }
                }
            },
            scales: {
                y: { beginAtZero: true, title: {display: true, text: 'Cantidad SQL'} }
            }
        }
    });
</script>

</body>
</html>